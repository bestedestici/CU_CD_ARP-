sets
i dugumler /0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21/
n(i) depolar /0,1/
ii(i) musteriler /2*21/
l(i) noktalar /2*21/
iii(i) depo /0,1/
k araçlar /1,2,3,4,5/
p ürünler /1,2/;
alias (i,j);
Table tc(i,j)
    0   1   2   3   4   5   6   7   8   9   10   11   12   13   14   15   16   17   18   19   20   21
0   0   14  21  33  17  14  11  26  22  23  28   12   8    29   18   25   22   17   15   32   32   32
1   14  0   12  19  31  22  17  23  12  24  34   12   21   42   27   36   19   31   28   46   21   27
2   21  12  0   15  37  21  28  35  22  16  28   11   25   50   38   35   9    34   36   51   12   15
3   33  19  15  0   50  36  35  35  21  31  43   25   38   61   46   51   23   48   47   64   8    24
4   17  31  37  50  0   20  21  37  38  33  31   27   13   15   18   19   35   8    8    15   49   45
5   14  22  21  36  20  0   25  40  33  12  14   11   9    35   30   15   16   15   23   32   33   25
6   11  17  28  35  21  25  0   16  18  34  40   22   18   27   10   34   32   25   15   35   38   41
7   26  23  35  35  37  40  16  0   14  46  54   33   34   40   22   51   41   41   30   50   40   50
8   22  12  22  21  38  33  18  14  0   36  46   24   30   45   28   46   30   39   32   52   26   37
9   23  24  16  31  33  12  34  46  36  0   12   13   21   48   41   23   8    27   35   44   25   13
10  28  34  28  43  31  14  40  54  46  12  0    22   23   46   44   16   20   24   36   39   37   24
11  12  12  35  25  27  11  22  33  24  13  22   0    14   40   30   26   10   23   26   40   23   20
12  8   21  22  38  13  9   18  34  30  21  23   14   0    27   21   17   23   10   14   26   37   33
13  29  42  16  61  15  35  27  40  45  48  46   40   27   0    18   32   50   22   14   14   62   59
14  18  27  28  46  18  30  10  22  28  41  44   30   21   18   0    35   40   24   10   29   48   50
15  25  36  11  51  19  15  34  51  46  23  16   26   17   32   35   0    30   11   25   23   47   37
16  22  19  25  23  35  16  32  41  30  8   20   10   23   50   40   30   0    31   36   48   18   10
17  17  31  50  48  8   15  25  41  39  27  24   23   10   22   24   11   31   0    14   17   46   40
18  15  28  38  47  8   23  15  30  32  35  36   26   14   14   10   25   36   14   0    20   47   46
19  32  46  35  64  15  32  35  50  52  44  39   40   26   14   29   23   48   17   20   0    63   57
20  32  21  9   8   49  33  38  40  26  25  37   23   37   62   48   47   18   46   47   63   0    17
21  32  27  34  24  45  25  41  50  37  13  24   20   33   59   50   37   10   40   46   57   17   0;
Table m(i,j)
    0   1   2   3   4   5   6   7   8   9   10   11   12   13   14   15   16   17   18   19   20   21
0   0   1   1   1   1   1   1   1   1   1   1    1    1    1    1    1    1    1    1    1    1    1
1   1   0   1   1   1   1   1   1   1   1   1    1    1    1    1    1    1    1    1    1    1    1
2   1   1   0   1   1   1   1   1   1   1   1    1    1    1    1    1    1    1    1    1    1    1
3   1   1   1   0   1   1   1   1   1   1   1    1    1    1    1    1    1    1    1    1    1    1
4   1   1   1   1   0   1   1   1   1   1   1    1    1    1    1    1    1    1    1    1    1    1
5   1   1   1   1   1   0   1   1   1   1   1    1    1    1    1    1    1    1    1    1    1    1
6   1   1   1   1   1   1   0   1   1   1   1    1    1    1    1    1    1    1    1    1    1    1
7   1   1   1   1   1   1   1   0   1   1   1    1    1    1    1    1    1    1    1    1    1    1
8   1   1   1   1   1   1   1   1   0   1   1    1    1    1    1    1    1    1    1    1    1    1
9   1   1   1   1   1   1   1   1   1   0   1    1    1    1    1    1    1    1    1    1    1    1
10  1   1   1   1   1   1   1   1   1   1   0    1    1    1    1    1    1    1    1    1    1    1
11  1   1   1   1   1   1   1   1   1   1   1    0    1    1    1    1    1    1    1    1    1    1
12  1   1   1   1   1   1   1   1   1   1   1    1    0    1    1    1    1    1    1    1    1    1
13  1   1   1   1   1   1   1   1   1   1   1    1    1    0    1    1    1    1    1    1    1    1
14  1   1   1   1   1   1   1   1   1   1   1    1    1    1    0    1    1    1    1    1    1    1
15  1   1   1   1   1   1   1   1   1   1   1    1    1    1    1    0    1    1    1    1    1    1
16  1   1   1   1   1   1   1   1   1   1   1    1    1    1    1    1    0    1    1    1    1    1
17  1   1   1   1   1   1   1   1   1   1   1    1    1    1    1    1    1    0    1    1    1    1
18  1   1   1   1   1   1   1   1   1   1   1    1    1    1    1    1    1    1    0    1    1    1
19  1   1   1   1   1   1   1   1   1   1   1    1    1    1    1    1    1    1    1    0    1    1
20  1   1   1   1   1   1   1   1   1   1   1    1    1    1    1    1    1    1    1    1    0    1
21  1   1   1   1   1   1   1   1   1   1   1    1    1    1    1    1    1    1    1    1    1    0;
Table a(i,p)
    1    2
0   0    0
1   0    0
2   20   80
3   100  60
4   30   70
5   40   30
6   10   20
7   30   40
8   30   40
9   60   10
10  10   20
11  20   70
12  40   20
13  20   50
14  100  10
15  20   50
16  40   30
17  50   20
18  60   10
19  40   40
20  30   40
21  25   50;
Parameter h(p) /1 1,2 2/;
Parameter cap /1100/;
Parameter depocap /1500/;
Binary Variables
x(i,j,k)
y(i,j);
Positive Variables
u(i,j,p);
Variable
z;
Equations Amac,kisit1,kisit2,kisit3,kisit4,kisit5,kisit6,kisit7,kisit8,kisit9,kisit10;
Amac..z=e=sum((i,j,k),x(i,j,k)*tc(i,j));
kisit1(ii)..sum((i,k),x(i,ii,k)*m(i,ii))=e=1;
kisit2(k,j)..(sum (i,x(i,j,k)))-(sum (i ,x(j,i,k)))=e=0;
kisit3(n,k)..(sum(ii,x(n,ii,k)))=l=1;
kisit4(n,k)..(sum(ii,x(ii,n,k)))=l=1;
kisit5(ii,p)..(sum(i,u(i,ii,p)*m(i,ii)))-(sum(i,u(ii,i,p)*m(ii,i)))=e=a(ii,p);
kisit6(i,j)..sum(p,u(i,j,p)*h(p))=l=cap*(sum(k,x(i,j,k)));
kisit7(ii)..sum(n,y(ii,n))=e=1;
kisit8(ii,n,k)..x(ii,n,k)=l=y(ii,n);
kisit9(ii,n,k)..x(n,ii,k)=l=y(ii,n);
kisit10(l,ii,n,k)$(ord(l)<>ord(ii)).. x(l,ii,k)+y(l,n)+sum(iii$(ord(iii)<>ord(n)), y(ii,iii))=l=2;

option resLim=72000;
model arp /all/;
solve arp using MIP minimizing z;
